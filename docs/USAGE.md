# Usage Guide - Graph Colouring Benchmark Suite

This guide provides comprehensive instructions for running all features of the benchmark suite.

---

## Table of Contents

1. [Building the Project](#1-building-the-project)
2. [Running a Single Algorithm on a Graph](#2-running-a-single-algorithm-on-a-graph)
3. [Creating Animation Snapshots](#3-creating-animation-snapshots)
4. [Animating Graph Colouring](#4-animating-graph-colouring)
5. [Running All Algorithms on One Graph](#5-running-all-algorithms-on-one-graph)
6. [Running One Algorithm on All Graphs](#6-running-one-algorithm-on-all-graphs)
7. [Running All Algorithms on All Graphs](#7-running-all-algorithms-on-all-graphs)
8. [Generating New Graphs](#8-generating-new-graphs)
9. [Understanding Outputs](#9-understanding-outputs)
10. [Python vs C++ Runner Differences](#10-python-vs-c-runner-differences)
11. [Quick Reference](#11-quick-reference)

---

## 1. Building the Project

### Prerequisites
- g++ with C++20 support
- Python 3.8+
- matplotlib, networkx (for animation only)

### Build Commands

```bash
# Build the benchmark runner
make all

# Clean build artifacts
make clean

# View all available make targets
make help
```

**Output:** `build/benchmark_runner` (the main executable)

---

## 2. Running a Single Algorithm on a Graph

### Using Makefile (Recommended)

```bash
# Basic syntax
make run-<algorithm> GRAPH=<path>

# Examples
make run-dsatur GRAPH=dimacs/myciel6.col
make run-tabu GRAPH=dimacs/queen8_8.col
make run-welsh GRAPH=generated/tree_275_4.col
make run-genetic GRAPH=dimacs/DSJC125.5.col
make run-sa GRAPH=dimacs/flat300_28_0.col
make run-exact GRAPH=simple-tests/k-12.col
```

### Available Algorithms

| Make Target | Algorithm | Best For |
|-------------|-----------|----------|
| `run-welsh` | Welsh-Powell | Fast baseline |
| `run-dsatur` | DSatur | Best general-purpose |
| `run-sa` | Simulated Annealing | Medium graphs |
| `run-genetic` | Genetic Algorithm | Exploration |
| `run-tabu` | Tabu Search | Hard instances |
| `run-exact` | Exact Solver | Small graphs only |

### Algorithm-Specific Parameters

#### Genetic Algorithm
```bash
make run-genetic GRAPH=dimacs/myciel6.col \
    POPULATION_SIZE=128 \
    GENERATIONS=1000 \
    MUTATION_RATE=0.05
```

| Parameter | Default | Description |
|-----------|---------|-------------|
| `POPULATION_SIZE` | 64 | Number of individuals in population |
| `GENERATIONS` | 500 | Maximum generations to evolve |
| `MUTATION_RATE` | 0.02 | Probability of mutation (0.0-1.0) |

#### Exact Solver
```bash
# Set progress interval via environment variable
EXACT_PROGRESS_INTERVAL=2.0 make run-exact GRAPH=dimacs/myciel3.col
```

| Parameter | Default | Description |
|-----------|---------|-------------|
| `EXACT_PROGRESS_INTERVAL` | 5.0 | Seconds between progress reports (0.05-600) |

### Using Direct CLI

```bash
./build/benchmark_runner \
    --algorithm dsatur \
    --input data/dimacs/myciel6.col \
    --output results/colourings/myciel6_dsatur.col \
    --results results/results.csv \
    --graph-name myciel6
```

### CLI Options Reference

| Option | Required | Description |
|--------|----------|-------------|
| `--algorithm NAME` | Yes | Algorithm to run |
| `--input FILE` | Yes | Path to input graph (.col) |
| `--output FILE` | No | Where to save colouring |
| `--results FILE` | No | CSV file to append metrics |
| `--graph-name NAME` | No | Override graph name in output |
| `--known-optimal N` | No | Known chromatic number |
| `--save-snapshots` | No | Save iteration states for animation |
| `--population-size N` | No | Genetic: population size |
| `--generations N` | No | Genetic: max generations |
| `--mutation-rate X` | No | Genetic: mutation rate |

### Where is the Colouring Stored?

1. **Console Output:** Runtime displayed immediately
2. **Colouring File:** `results/colourings/<graph>_<algorithm>.col`
3. **CSV Metrics:** Appended to `results/results.csv`

**Colouring file format:**
```
c colouring generated by benchmark framework
p edge 95 755
v 1 0
v 2 1
v 3 2
...
```
(Each line `v <vertex> <colour>` shows the assigned colour)

---

## 3. Creating Animation Snapshots

Snapshots record the algorithm's state at each iteration, enabling visualization.

### Enable Snapshots via Makefile

```bash
# Add SNAPSHOTS=1 to any run command
make run-dsatur GRAPH=dimacs/myciel6.col SNAPSHOTS=1
make run-tabu GRAPH=dimacs/queen5_5.col SNAPSHOTS=1
make run-genetic GRAPH=dimacs/myciel3.col SNAPSHOTS=1 GENERATIONS=200
```

### Enable Snapshots via CLI

```bash
./build/benchmark_runner \
    --algorithm tabu_search \
    --input data/dimacs/myciel6.col \
    --save-snapshots
```

### Snapshot Output Location

**Path:** `output/snapshots/<algorithm>-<graph>-snapshots.txt`

**Example:** `output/snapshots/dsatur-myciel6-snapshots.txt`

### Snapshot File Format

Each line represents one iteration, with space-separated colour values:
```
-1 -1 -1 -1 -1 -1 0        # Step 1: only vertex 6 coloured (colour 0)
-1 -1 -1 -1 -1 1 0         # Step 2: vertex 5 gets colour 1
-1 -1 -1 -1 2 1 0          # Step 3: vertex 4 gets colour 2
...
0 1 2 1 2 1 0              # Final: all vertices coloured
```

**Legend:**
- `-1` = uncoloured vertex
- `0, 1, 2, ...` = assigned colour number

---

## 4. Animating Graph Colouring

The animation tool visualizes how algorithms colour graphs step-by-step.

### Basic Animation

```bash
# Animate a single algorithm
python3 tools/animate_coloring.py --graph myciel6 --algo dsatur

# Graph can be specified multiple ways:
python3 tools/animate_coloring.py --graph myciel6 --algo dsatur           # Bare name
python3 tools/animate_coloring.py --graph dimacs/myciel6.col --algo dsatur  # Relative path
python3 tools/animate_coloring.py --graph queen8_8 --algo tabu_search
```

### Animation Timing Options

```bash
# Adjust frame interval (default 0.2 seconds)
python3 tools/animate_coloring.py --graph myciel6 --algo dsatur --interval 0.5

# Faster animation
python3 tools/animate_coloring.py --graph myciel6 --algo dsatur --interval 0.05

# Special interval for simulated annealing (has many iterations)
python3 tools/animate_coloring.py --graph myciel6 --algo simulated_annealing --sa-interval 0.01
```

| Option | Default | Description |
|--------|---------|-------------|
| `--interval X` | 0.2 | Seconds between frames |
| `--sa-interval X` | None | Override interval for simulated annealing |

### Manual Stepping Mode

Step through the animation frame-by-frame:

```bash
python3 tools/animate_coloring.py --graph myciel6 --algo dsatur --manual
```

**Controls:**
| Key | Action |
|-----|--------|
| `Enter`, `Space`, `k`, `→` | Next frame |
| `←`, `h` | Previous frame |
| `q`, `Escape` | Quit |

### Layout Options

```bash
# Spring layout (default, requires networkx)
python3 tools/animate_coloring.py --graph myciel6 --algo dsatur --layout spring

# Circular layout (fallback)
python3 tools/animate_coloring.py --graph myciel6 --algo dsatur --layout circular

# Set random seed for reproducible layout
python3 tools/animate_coloring.py --graph myciel6 --algo dsatur --seed 123
```

### Algorithm-Specific Options (for auto-run)

```bash
# Genetic algorithm with custom parameters
python3 tools/animate_coloring.py --graph myciel6 --algo genetic \
    --population-size 128 \
    --generations 800 \
    --mutation-rate 0.03

# Exact solver with progress interval
python3 tools/animate_coloring.py --graph myciel3 --algo exact_solver \
    --exact-progress-interval 2.0
```

### Additional Options

```bash
# Loop animation forever
python3 tools/animate_coloring.py --graph myciel6 --algo dsatur --repeat

# Skip running C++ binary (use existing snapshots)
python3 tools/animate_coloring.py --graph myciel6 --algo dsatur --skip-run

# Full help
python3 tools/animate_coloring.py --full-help
```

---

## 5. Running All Algorithms on One Graph

### Compare All Algorithms Side-by-Side (Animation)

```bash
python3 tools/animate_coloring.py --graph myciel6 --all-algos
```

This opens a 2×3 grid showing all 6 algorithms animating simultaneously.

### Run All Algorithms Sequentially (Benchmarking)

```bash
# Using the Python orchestrator with a single graph
python3 tools/run_all_benchmarks.py --graphs data/dimacs/myciel6.col

# Multiple specific graphs
python3 tools/run_all_benchmarks.py \
    --graphs data/dimacs/myciel6.col data/dimacs/queen8_8.col data/generated/tree_275_4.col
```

### Manual Loop (Shell)

```bash
GRAPH=dimacs/myciel6.col
for algo in welsh dsatur sa genetic tabu exact; do
    make run-$algo GRAPH=$GRAPH
done
```

---

## 6. Running One Algorithm on All Graphs

### Using Shell Loop

```bash
# Run DSatur on all DIMACS graphs
for graph in data/dimacs/*.col; do
    ./build/benchmark_runner \
        --algorithm dsatur \
        --input "$graph" \
        --output "results/colourings/$(basename ${graph%.col})_dsatur.col" \
        --results results/dsatur_all.csv
done

# Run Tabu Search on all generated graphs
for graph in data/generated/*.col; do
    ./build/benchmark_runner \
        --algorithm tabu_search \
        --input "$graph" \
        --results results/tabu_generated.csv
done
```

### Using Python (Modify ALGORITHMS list)

Edit `tools/run_all_benchmarks.py` and change:
```python
ALGORITHMS = [
    "dsatur",  # Only run DSatur
]
```

Then run:
```bash
python3 tools/run_all_benchmarks.py --include-generated
```

---

## 7. Running All Algorithms on All Graphs

### Using Makefile

```bash
make run-all-benchmarking
```

This runs `tools/run_all_benchmarks.py --include-generated` with default timeouts.

### Using Python Directly

```bash
# DIMACS graphs only
python3 tools/run_all_benchmarks.py

# Include generated graphs
python3 tools/run_all_benchmarks.py --include-generated

# Custom timeouts
python3 tools/run_all_benchmarks.py \
    --include-generated \
    --first-timeout 30 \
    --second-timeout 60
```

### Timeout Behavior

| Pass | Timeout | Action on Timeout |
|------|---------|-------------------|
| First | 15s (default) | Defer to second pass |
| Second | 30s (default) | Mark as `timeout>45s` |

### Output

- **Colourings:** `results/colourings/<graph>_<algo>.col`
- **Aggregate CSV:** `results/run_all_results.csv`

---

## 8. Generating New Graphs

### Generate All Graph Types

```bash
cd /path/to/graph-colouring
python3 tools/generate_graphs.py
```

### Options

```bash
# Specify output directory
python3 tools/generate_graphs.py --target data/generated

# Set random seed (for reproducibility)
python3 tools/generate_graphs.py --seed 42

# Overwrite existing graphs
python3 tools/generate_graphs.py --overwrite

# Generate only specific types
python3 tools/generate_graphs.py --types tree grid erdos_renyi
```

### Available Graph Types

| Type | Description |
|------|-------------|
| `bipartite` | Two-partition graphs (χ=2) |
| `planar` | Planar graphs (χ≤4) |
| `tree` | Tree structures (χ=2) |
| `grid` | 2D grid graphs (χ=2 or 3) |
| `erdos_renyi` | Random graphs (G(n,p)) |
| `barabasi_albert` | Scale-free networks |
| `watts_strogatz` | Small-world networks |
| `complete` | Complete graphs Kₙ (χ=n) |

### Regenerating with Same Seed

To reproduce the exact same graphs:
```bash
python3 tools/generate_graphs.py --seed 42 --overwrite
```

---

## 9. Understanding Outputs

### Output Locations

| Output | Location | Description |
|--------|----------|-------------|
| Colouring files | `results/colourings/*.col` | Vertex-colour assignments |
| Single-run CSV | `results/results.csv` | Metrics from individual runs |
| Batch CSV | `results/run_all_results.csv` | Aggregate batch results |
| Snapshots | `output/snapshots/*.txt` | Animation frame data |
| Animations | `output/animations/` | Saved animation videos |

### Results CSV Schema

```csv
algorithm,graph_name,vertices,edges,colors_used,known_optimal,runtime_ms,status
dsatur,myciel6,95,755,7,7,0.234,ok
tabu_search,queen8_8,64,728,9,9,156.78,ok
genetic,DSJC125.5,125,3891,20,17,2340.56,ok
exact_solver,k-12,12,66,12,12,0.045,ok
simulated_annealing,flat300_28_0,300,21695,36,28,timeout>45s
```

### Status Values

| Status | Meaning |
|--------|---------|
| `ok` | Completed successfully on first attempt |
| `ok(retry)` | Completed on second attempt |
| `ok(no-parse)` | Completed but couldn't parse metrics |
| `timeout>45s` | Exceeded both timeout passes |
| `error` | Non-zero exit code (crash) |

---

## 10. Python vs C++ Runner Differences

### C++ Benchmark Runner (`build/benchmark_runner`)

**Use for:**
- Single algorithm runs
- Maximum performance
- Direct control over parameters
- Generating snapshots

**Characteristics:**
- Compiled binary, very fast
- No timeout handling
- Runs one (graph, algorithm) pair
- Outputs to files and CSV

**Example:**
```bash
./build/benchmark_runner --algorithm dsatur --input data/dimacs/myciel6.col
```

### Python Orchestrator (`tools/run_all_benchmarks.py`)

**Use for:**
- Batch runs across many graphs
- Automatic timeout and retry logic
- Aggregating results
- Parallel-safe result collection

**Characteristics:**
- Calls C++ runner as subprocess
- Handles timeouts (kills hung processes)
- Two-pass retry logic
- Aggregates all results into one CSV

**Example:**
```bash
python3 tools/run_all_benchmarks.py --include-generated --first-timeout 20
```

### When to Use Which

| Scenario | Tool |
|----------|------|
| Quick test of one algorithm | C++ (make run-xxx) |
| Benchmarking all algorithms | Python orchestrator |
| Creating animation | C++ with SNAPSHOTS=1 |
| Large batch with timeouts | Python orchestrator |
| Custom parameters | C++ direct CLI |
| Research experiments | Python orchestrator |

---

## 11. Quick Reference

### Most Common Commands

```bash
# Build
make all

# Run DSatur on a graph
make run-dsatur GRAPH=dimacs/myciel6.col

# Run Tabu Search with snapshots
make run-tabu GRAPH=dimacs/queen8_8.col SNAPSHOTS=1

# Animate a single algorithm
python3 tools/animate_coloring.py --graph myciel6 --algo dsatur

# Animate all algorithms side-by-side
python3 tools/animate_coloring.py --graph myciel6 --all-algos

# Run all benchmarks
make run-all-benchmarking

# Generate graphs
python3 tools/generate_graphs.py --seed 42
```

### Algorithm Comparison Cheat Sheet

| Algorithm | Speed | Quality | Best Use Case |
|-----------|-------|---------|---------------|
| Welsh-Powell | ★★★★★ | ★★☆☆☆ | Quick baseline |
| DSatur | ★★★★☆ | ★★★★☆ | General purpose |
| Simulated Annealing | ★★★☆☆ | ★★★☆☆ | Medium graphs |
| Genetic | ★★☆☆☆ | ★★★☆☆ | Research/exploration |
| Tabu Search | ★★★☆☆ | ★★★★☆ | Hard instances |
| Exact Solver | ★☆☆☆☆ | ★★★★★ | Small graphs (<50 vertices) |

### Graph Path Shortcuts

When using animation tool, graphs can be specified as:

| Input | Resolved Path |
|-------|---------------|
| `myciel6` | `data/dimacs/myciel6.col` |
| `dimacs/queen8_8.col` | `data/dimacs/queen8_8.col` |
| `generated/tree_275_4.col` | `data/generated/tree_275_4.col` |
| `/absolute/path/graph.col` | As specified |

---

## Troubleshooting

### "benchmark_runner not found"
```bash
make all  # Build first
```

### "matplotlib import error"
```bash
pip install matplotlib networkx
# or
conda install matplotlib networkx
```

### Animation shows no graph
```bash
# Ensure snapshots exist
ls output/snapshots/

# Or regenerate with SNAPSHOTS=1
make run-dsatur GRAPH=dimacs/myciel6.col SNAPSHOTS=1
```

### Timeout on large graphs
```bash
# Increase timeouts
python3 tools/run_all_benchmarks.py --first-timeout 60 --second-timeout 120
```

---

## 12. Bonus Applications

### University Exam Scheduler

A graphical application for conflict-free exam timetabling using graph colouring.

```bash
cd bonus/exam_scheduler
python3 exam_scheduler.py
```

**Features:**
- Load student registrations from CSV
- Automatic conflict graph construction
- DSatur and Exact solver algorithms
- Visual timetable display
- Export to CSV

**CSV Format (student registrations):**
```csv
student_id,course1,course2,course3,...
```

### Maximum Clique Finder

Find the maximum clique (largest complete subgraph) using Bron-Kerbosch algorithm.

```bash
cd bonus/max_clique

# Build
g++ -O3 -std=c++17 max_clique.cpp -o max_clique

# Run
./max_clique ../../data/dimacs/myciel6.col

# Batch experiments
python3 run_dimacs.py
python3 run_generated.py
```

**Why it matters:**
- Clique number ω(G) is a lower bound for chromatic number χ(G)
- Validates colouring quality: if colours_used = ω(G), colouring is optimal
- Results in `bonus/max_clique/results/`
